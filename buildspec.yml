version: 0.2
phases:
  install:
    commands:
      - apt-get update
      - apt-get install jq zip
  build:
    commands:
      - cd source
      - zip -r9 ../lambda.zip *
      - cd ..
      - aws s3api put-object --bucket codepipeline-eu-west-3-50005514925 --key lambda.zip --server-side-encryption aws:kms --body lambda.zip > response.json
      - cat response.json
      - cat response.json | jq '{"Parameters":{"VersionId":.VersionId}}' > configuration.json
      - cat configuration.json
artifacts:
  files:
    - configuration.json
